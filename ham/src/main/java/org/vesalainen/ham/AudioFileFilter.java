/*
 * Copyright (C) 2018 Timo Vesalainen <timo.vesalainen@iki.fi>
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */
package org.vesalainen.ham;

import java.io.IOException;
import java.nio.file.Path;
import javax.sound.sampled.AudioFileFormat;
import javax.sound.sampled.AudioInputStream;
import javax.sound.sampled.AudioSystem;
import javax.sound.sampled.UnsupportedAudioFileException;
import org.vesalainen.ham.fft.FilterAudioInputStream;
import org.vesalainen.ham.filter.FIRFilter;

/**
 *
 * @author Timo Vesalainen <timo.vesalainen@iki.fi>
 */
public class AudioFileFilter
{
    public static double[] BAND_PASS = new double[]{1.988861413599843E-21, -2.9273156798677875E-8, -1.9943641308195102E-7, -5.780703797196122E-7, -1.1429431366607908E-6, -1.7847875916229447E-6, -2.3356999166117234E-6, -2.617312832453118E-6, -2.497927634211872E-6, -1.9448295925276064E-6, -1.0577758096711424E-6, -7.236981090029682E-8, 6.725842942638356E-7, 8.024523304441646E-7, -2.2200167026150287E-10, -1.893088905469238E-6, -4.782406869977547E-6, -8.264383651521334E-6, -1.1618491043866006E-5, -1.3864935926227057E-5, -1.388832731896553E-5, -1.0617567705775802E-5, -3.240009322913155E-6, 8.581944408949408E-6, 2.4529364869072166E-5, 4.351815472654066E-5, 6.369469866766793E-5, 8.255488636065804E-5, 9.718831527256175E-5, 1.0462953203120856E-4, 1.0227843936975153E-4, 8.83356764429634E-5, 6.218889068468223E-5, 2.4684701295521793E-5, -2.1769967042585577E-5, -7.33148297539927E-5, -1.249624032844101E-4, -1.7112275441889937E-4, -2.0627408945745067E-4, -2.25698598079241E-4, -2.2618412607957868E-4, -2.0658625065273124E-4, -1.6815447348091342E-4, -1.1455078214269971E-4, -5.1526712678880165E-5, 1.3727993977825258E-5, 7.350208615977424E-5, 1.206359739972529E-4, 1.4960809823245355E-4, 1.574745084774626E-4, 1.4450696641909167E-4, 1.144036676474258E-4, 7.399706906246003E-5, 3.24500766873159E-5, 6.815592897729036E-9, -1.35628213364986E-5, -6.25568877328465E-7, 4.278224782598922E-5, 1.1579396536085933E-4, 2.1213854627443802E-4, 3.2030543544690304E-4, 4.245097876381432E-4, 5.064107471205897E-4, 5.474224313146272E-4, 5.313557860741664E-4, 4.470551312953036E-4, 2.9065915462522123E-4, 6.713095325920046E-5, -2.092320856421627E-4, -5.154848511809928E-4, -8.219457817872763E-4, -0.0010951955848309347, -0.0013018647219382442, -0.0014127765293562708, -0.0014069263907161844, -0.0012747549952956698, -0.0010202238456352992, -6.61322844307704E-4, -2.2882196354704902E-4, 2.3669864747681064E-4, 6.892707603122631E-4, 0.0010829267970104985, 0.0013774034609810933, 0.0015434191674730197, 0.0015667897149330523, 0.0014507534433113444, 0.0012160780002808264, 8.987950387531344E-4, 5.45724281113527E-4, 2.0826394872390714E-4, -6.480291521636394E-5, -2.3454792078914967E-4, -2.78171383483243E-4, -1.9336115937816764E-4, 1.6464818955279348E-8, 2.6133112403372487E-4, 5.337462550975635E-4, 7.515249493298848E-4, 8.492765547334382E-4, 7.720053335270847E-4, 4.846223706555684E-4, -2.0449976191901477E-5, -7.187989875992492E-4, -0.0015535557086689233, -0.002439354918892356, -0.0032705671376079305, -0.003933061235532325, -0.00431822509577336, -0.004337572480645277, -0.0039360595088831765, -0.0031022647074929787, -0.0018738644262507888, -3.373401597182068E-4, 0.0013784659430263273, 0.003114555021568387, 0.00469856661083023, 0.005964323442395547, 0.006771809473744311, 0.007025062998547167, 0.006685581962118214, 0.005779275270323386, 0.00439571424690949, 0.0026793651064495492, 8.135072008864756E-4, -0.0010014656005512533, -0.002572833722723011, -0.003740356576050847, -0.004397841335048492, -0.004508461929225899, -0.004111461315160525, -0.0033188659561975103, -0.002302077137621909, -0.0012695326692587672, -4.378874088829428E-4, -1.7446309517887837E-7, -9.503493505601864E-5, -7.812381971031663E-4, -0.0020213095544008436, -0.003677156898985009, -0.0055192291670298575, -0.007249093935979974, -0.008533580947437834, -0.009047017248547656, -0.008516789604111823, -0.006766692748617954, -0.003752385820058373, 4.161608716439606E-4, 0.005469118779852301, 0.010990259888112782, 0.016449373440314868, 0.021251309485260023, 0.024797174194126963, 0.026551462467088192, 0.026107807470006406, 0.023245718349066927, 0.0179712426979117, 0.010535905245014316, 0.0014304130784496714, -0.008647735439817873, -0.0188507301242888, -0.028256235001653723, -0.03595534355771425, -0.04114391243493234, -0.043207743981168015, -0.041792377672563025, -0.036849568112418817, -0.028654755463078628, -0.017792748838297512, -0.005112137467230708, 0.00834773795574869, 0.021450446205582507, 0.033067652290691495, 0.04218536396099898, 0.04800051321108813, 0.04999803110681944, 0.04800051321108813, 0.04218536396099898, 0.033067652290691495, 0.021450446205582507, 0.00834773795574869, -0.005112137467230708, -0.017792748838297512, -0.028654755463078628, -0.036849568112418817, -0.04179237767256303, -0.04320774398116803, -0.04114391243493234, -0.03595534355771425, -0.028256235001653723, -0.0188507301242888, -0.008647735439817868, 0.0014304130784496714, 0.010535905245014316, 0.0179712426979117, 0.023245718349066927, 0.026107807470006406, 0.026551462467088206, 0.02479717419412697, 0.021251309485260023, 0.016449373440314868, 0.010990259888112782, 0.005469118779852303, 4.161608716439606E-4, -0.003752385820058373, -0.006766692748617955, -0.008516789604111825, -0.009047017248547657, -0.008533580947437837, -0.007249093935979974, -0.005519229167029856, -0.0036771568989850075, -0.0020213095544008436, -7.812381971031655E-4, -9.503493505602038E-5, -1.7446309517887837E-7, -4.378874088829445E-4, -0.001269532669258768, -0.00230207713762191, -0.003318865956197512, -0.004111461315160526, -0.004508461929225901, -0.004397841335048493, -0.0037403565760508453, -0.0025728337227230117, -0.0010014656005512533, 8.135072008864765E-4, 0.0026793651064495497, 0.004395714246909491, 0.0057792752703233865, 0.006685581962118218, 0.007025062998547162, 0.006771809473744311, 0.005964323442395543, 0.004698566610830229, 0.0031145550215683866, 0.0013784659430263275, -3.3734015971820675E-4, -0.0018738644262507893, -0.0031022647074929787, -0.003936059508883179, -0.004337572480645279, -0.004318225095773358, -0.003933061235532326, -0.0032705671376079292, -0.002439354918892356, -0.0015535557086689238, -7.187989875992507E-4, -2.0449976191901477E-5, 4.846223706555686E-4, 7.720053335270849E-4, 8.492765547334392E-4, 7.515249493298842E-4, 5.337462550975635E-4, 2.613311240337247E-4, 1.6464818955279348E-8, -1.9336115937816764E-4, -2.781713834832432E-4, -2.3454792078914967E-4, -6.480291521636372E-5, 2.0826394872390714E-4, 5.457242811135275E-4, 8.987950387531348E-4, 0.001216078000280826, 0.0014507534433113455, 0.0015667897149330523, 0.0015434191674730206, 0.0013774034609810941, 0.0010829267970104996, 6.892707603122633E-4, 2.3669864747681083E-4, -2.288219635470492E-4, -6.613228443077053E-4, -0.0010202238456352988, -0.0012747549952956704, -0.0014069263907161838, -0.0014127765293562716, -0.0013018647219382436, -0.0010951955848309356, -8.219457817872763E-4, -5.154848511809933E-4, -2.092320856421627E-4, 6.713095325920057E-5, 2.9065915462522134E-4, 4.470551312953036E-4, 5.31355786074167E-4, 5.474224313146273E-4, 5.064107471205895E-4, 4.245097876381434E-4, 3.2030543544690293E-4, 2.1213854627443815E-4, 1.1579396536085928E-4, 4.278224782598933E-5, -6.25568877328465E-7, -1.3562821336498654E-5, 6.815592897674826E-9, 3.245007668731587E-5, 7.399706906246007E-5, 1.144036676474258E-4, 1.4450696641909184E-4, 1.5747450847746264E-4, 1.4960809823245377E-4, 1.2063597399725294E-4, 7.35020861597744E-5, 1.3727993977825286E-5, -5.152671267888034E-5, -1.1455078214269953E-4, -1.681544734809134E-4, -2.0658625065273113E-4, -2.2618412607957895E-4, -2.2569859807924082E-4, -2.0627408945745107E-4, -1.7112275441889937E-4, -1.2496240328441037E-4, -7.331482975399277E-5, -2.1769967042585618E-5, 2.4684701295521806E-5, 6.218889068468216E-5, 8.833567644296368E-5, 1.0227843936975153E-4, 1.0462953203120877E-4, 9.718831527256164E-5, 8.255488636065833E-5, 6.369469866766804E-5, 4.351815472654094E-5, 2.452936486907218E-5, 8.581944408949459E-6, -3.240009322913165E-6, -1.0617567705775795E-5, -1.3888327318965619E-5, -1.3864935926227088E-5, -1.1618491043866038E-5, -8.2643836515214E-6, -4.782406869977547E-6, -1.8930889054692423E-6, -2.2200167026150287E-10, 8.024523304441731E-7, 6.725842942638339E-7, -7.236981090029682E-8, -1.0577758096711526E-6, -1.9448295925276064E-6, -2.4979276342119085E-6, -2.6173128324531434E-6, -2.3356999166117234E-6, -1.7847875916229786E-6, -1.1429431366607908E-6, -5.780703797195212E-7, -1.9943641308195102E-7, -2.9273156798677875E-8, 1.988861413599843E-21, 0.0};
    public static double[] LOW_PASS = new double[]{0.0, 2.6911230374230087E-6, 6.8531414772195044E-6, 4.598430571415954E-6, -1.2610397492823773E-5, -5.1029177578800035E-5, -1.1181306606484084E-4, -1.8898691733299704E-4, -2.6878994264360615E-4, -3.3076545187841333E-4, -3.5066028616051925E-4, -3.0484739029516616E-4, -1.7564736162278363E-4, 4.333841572907357E-5, 3.429059681759098E-4, 6.959324603602001E-4, 0.0010578541052105746, 0.0013703597881355033, 0.001568236123271196, 0.0015887611331693778, 0.0013825331771233989, 9.242232494723081E-4, 2.2152725402053614E-4, -6.793760645341174E-4, -0.0016932637734990005, -0.002701065902062488, -0.0035609473034684857, -0.004124555879396856, -0.004256875808913662, -0.003857403504731494, -0.0028798795702865867, -0.0013476537411182498, 6.380138862671446E-4, 0.002898796293485619, 0.00519040883659394, 0.007223897170782275, 0.008695695722693908, 0.009323777217600908, 0.008886159774924036, 0.007257354049695598, 0.0044381351307012755, 5.743752301987314E-4, -0.004038428349993602, -0.008966920246584128, -0.01366822102113473, -0.017533222584336036, -0.01994141670971708, -0.020322279031762574, -0.01821715266271973, -0.013335119234427411, -0.005596594995819213, 0.004840649706049669, 0.017576755952789288, 0.031987964148701406, 0.047267028313777125, 0.06248281760304204, 0.07665397349859093, 0.08882988822791502, 0.09817134489244345, 0.10402302773649433, 0.10597079950932019, 0.1038780875803085, 0.09789777149410987, 0.08845840324282386, 0.07622615480448747, 0.062046298455019036, 0.0468700245775828, 0.03167377688333067, 0.017378894916904142, 0.00477914381139418, -0.005517281347987631, -0.013126341043783223, -0.017904508111690958, -0.019942417669108935, -0.019537636124714198, -0.01715039437929928, -0.013347655893519213, -0.008741776046066558, -0.003930186240435795, 5.579817714991016E-4, 0.004303537259574297, 0.007023912366788973, 0.008583476273246933, 0.008987921118051134, 0.0083648277919184, 0.0069338322498711516, 0.0049706438461168895, 0.0027694546151307412, 6.080283331302848E-4, -0.0012809603890401502, -0.002729833735141995, -0.0036458237644984206, -0.004011040619760106, -0.003873708102012371, -0.0033327832331832177, -0.002518634659717851, -0.0015726288659953572, -6.282764413792172E-4, 2.0391776422060855E-4, 8.464827796823621E-4, 0.001259299538262148, 0.0014384352483039324, 0.0014104150754147562, 0.0012233456797083016, 9.365513352329981E-4, 6.103734310271342E-4, 2.975453867961886E-4, 3.714409008946301E-5, -1.4838824673864292E-4, -2.5317852275414965E-4, -2.8529667700061994E-4, -2.6238325456292254E-4, -2.0651258886241494E-4, -1.3926833772223766E-4, -7.784692880147089E-5, -3.2727095404473005E-5, -7.1049001240826E-6, 2.046123023442111E-6, 1.7144800101279176E-6, 0.0};

    public static final void filter(Path in, Path out) throws IOException, UnsupportedAudioFileException
    {
        try (   AudioInputStream ais = AudioSystem.getAudioInputStream(in.toFile());
                FilterAudioInputStream fais = new FilterAudioInputStream(ais, 4096)
                )
        {
            FIRFilter filter = new FIRFilter(BAND_PASS);
            fais.addListener(filter);
            AudioSystem.write(fais, AudioFileFormat.Type.WAVE, out.toFile());
        }
    }
}
